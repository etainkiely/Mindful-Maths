<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Mind‚ÄëLoving Maths ‚Äî Sets & Probability</title>
  <style>
    :root{
      --bg:#0f172a;
      --card:#111827ee;
      --ink:#e5e7eb;
      --muted:#94a3b8;
      --accent:#14b8a6;
      --accent-2:#22d3ee;
      --bad:#ef4444;
      --good:#22c55e;
      --gold:#fbbf24;
      --shadow: 0 12px 30px rgba(0,0,0,.35);
      --radius: 18px;
    }
    *{box-sizing:border-box;font-family: Inter, system-ui, -apple-system, Segoe UI, Roboto, Arial, "Noto Sans", "Apple Color Emoji";}
    html,body{height:100%;}
    body{margin:0;background: radial-gradient(1200px 800px at 20% -10%, #1e293b, #0b1020 60%), var(--bg); color:var(--ink);}
    .wrap{max-width:1100px;margin:12px auto;padding:12px;}
    header.hero{display:flex;gap:16px;align-items:center;justify-content:space-between;margin-bottom:12px;padding:14px;border-radius:14px;background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(0,0,0,0.02));}
    .brand{display:flex;align-items:center;gap:12px}
    .hero-svg{max-height:120px;height:auto;width:auto}
    h1{font-size:clamp(18px,3.6vw,26px);margin:0}
    .card{background:linear-gradient(180deg, rgba(255,255,255,.03), rgba(255,255,255,.01));border:1px solid rgba(255,255,255,.06);border-radius:var(--radius);box-shadow:var(--shadow);padding:16px}
    .row{display:flex;gap:12px;flex-wrap:wrap;align-items:center}
    .pill{background:#0b1222;border:1px solid rgba(255,255,255,.08);padding:8px 12px;border-radius:999px;color:var(--muted)}
    select, button, input[type="number"], input[type="text"]{background:#0b1222;color:var(--ink);border:1px solid rgba(255,255,255,.12);border-radius:12px;padding:10px 12px}
    button{cursor:pointer;transition:transform .04s ease, box-shadow .2s ease}
    button:hover{transform:translateY(-1px)}
    button.primary{background:linear-gradient(135deg, var(--accent), var(--accent-2)); color:#00222a; border:none; font-weight:700}
    button.good{background:linear-gradient(135deg, #34d399, #10b981);border:none;color:#052018;font-weight:700}
    button.bad{background:linear-gradient(135deg, #f87171, #ef4444);border:none;color:#2a0000;font-weight:700}
    .muted{color:var(--muted)}
    .grid{display:grid;gap:12px}
    .g-2{grid-template-columns:repeat(2,minmax(0,1fr))}
    @media (max-width:860px){.g-2{grid-template-columns:1fr}}
    .progress{height:10px;background:rgba(255,255,255,.08);border-radius:999px;overflow:hidden}
    .bar{height:100%;width:0;background:linear-gradient(90deg,var(--accent),var(--accent-2));transition:width .4s ease}
    .msg{padding:10px 12px;border-radius:10px;border:1px dashed rgba(255,255,255,.12);background:rgba(20,20,35,.4)}
    .question{font-size:clamp(20px,4.0vw,28px);font-weight:800;line-height:1.25;color:#fff;}
    .qbox{padding:14px;border-radius:12px;background:#0b1222;border:1px solid rgba(255,255,255,.06);}
    .inline-reflect{display:flex;gap:8px;align-items:center;margin-top:8px}
    .stack-right{display:flex;gap:8px;justify-content:flex-end;flex-wrap:wrap}
    .tiny{font-size:12px}
    #fx{position:fixed;inset:0;pointer-events:none;overflow:hidden}
    .confetti{position:absolute;width:8px;height:12px;opacity:.9}
    @keyframes fall{to{transform:translateY(110vh) rotate(720deg);opacity:0}}
    @media (prefers-reduced-motion: reduce){*, *::before, *::after{animation:none !important; transition:none !important}}
    .hero-meta{flex:1;min-width:0}
    .hero-meta p{margin:6px 0 0;color:var(--muted);font-size:14px}
  </style>
</head>
<body>
  <div class="wrap">
    <!-- Embedded calm banner (inline SVG) -->
    <header class="hero" role="banner" aria-label="Mind‚ÄëLoving Maths header">
      <img src="mind-loving-logo.svg" alt="Mind-Loving Maths logo" style="height:86px;">

      <div class="hero-meta">
        <h1>Mind‚ÄëLoving Maths</h1>
        <p>Gentle practice for sets & probability ‚Äî small steps, steady confidence.</p>
      </div>

      <div class="row" style="align-items:center">
        <div id="loadedCount" class="pill">Questions: ‚Äî</div>
        <button id="previewModeBtn" class="primary">Preview Session</button>
      </div>
    </header>

    <section class="card grid g-2" role="region" aria-label="Mastery Controls">
      <div>
        <label class="muted tiny">Choose a Level</label><br/>
        <select id="levelPicker" aria-label="Choose level">
          <option value="L1">Level 1 ‚Äî Sets basics (‚àà, subsets, #A)</option>
          <option value="L2">Level 2 ‚Äî Venn & counts (A‚à™B, A‚à©B, only)</option>
          <option value="L3">Level 3 ‚Äî Probability (bags & outcomes)</option>
          <option value="L4">Level 4 ‚Äî Challenge mix (strategy)</option>
        </select>
        <div class="tiny muted" style="margin-top:6px">Goal: Master a level by answering 5 in a row. A session is tuned for ~30‚Äì40 minutes.</div>
      </div>
      <div>
        <label class="muted tiny">Mastery Progress</label>
        <div class="progress" aria-hidden="true"><div id="progressBar" class="bar"></div></div>
        <div class="row" style="margin-top:6px">
          <span class="tag">Level mastery: <strong id="levelMastery">0/5</strong></span>
          <span class="tag">Type repetitions: <strong id="repLeft">3</strong></span>
        </div>
      </div>
    </section>

    <section class="card grid highlight" style="margin-top:12px" role="region" aria-live="polite" aria-label="Question">
      <div class="row" style="justify-content:space-between">
        <div class="tiny muted">If you wobble, that‚Äôs data ‚Äî try a new strategy.</div>
        <div class="tiny muted">Attempts remaining: <span id="attemptsLeft">3</span></div>
      </div>
      <div id="questionText" class="question qbox tight">Press Preview Session to start a short, guided run.</div>
      <div id="workArea" class="tight"></div>
      <div id="feedback" class="msg coach tiny" style="display:none;margin-top:10px"></div>
      <div class="inline-reflect" id="inlineReflectRow" style="display:none">
        <label class="tiny muted" for="reflectInline">Quick reflect:</label>
        <input id="reflectInline" type="text" placeholder="What worked? One tiny next step‚Ä¶" />
      </div>
      <div class="stack-right" style="margin-top:10px">
        <button id="hintBtn" class="cta">üîç Clue</button>
        <button id="checkBtn" class="primary cta">Check</button>
        <button id="submitBtn" class="good cta" style="display:none">Submit & Next</button>
        <button id="quickNextBtn" class="good cta big" style="display:none">Next ‚ñ∂</button>
        <button id="skipBtn" class="bad cta">Skip</button>
      </div>
    </section>

    <section id="tipsCard" class="card grid" style="margin-top:12px" role="region" aria-label="Tips">
      <div class="tiny">
        <span class="muted">Coach tips:</span>
        Name what you know ‚Üí act on one step ‚Üí check ‚Üí adjust. Using a clue is smart learning.
      </div>
    </section>
  </div>

  <div id="wheelModal" class="modal" role="dialog" aria-modal="true" aria-label="Reward wheel" style="display:none">
    <div class="wheel-wrap card" style="max-width:520px;margin:40px auto;">
      <div class="center"><div class="pointer"></div></div>
      <div class="wheel" id="wheel"></div>
      <div class="center" style="gap:10px;margin-top:12px">
        <button id="spinBtn" class="primary">Spin to claim reward</button>
        <button id="closeWheelBtn">Close</button>
      </div>
      <div id="wheelMsg" class="center tiny" style="margin-top:8px;color:var(--muted)">Device‚Äëtime rewards vary 0‚Äì5 min. Caps apply for healthy balance.</div>
    </div>
  </div>
  <div id="fx"></div>

<script>
  // SESSION CONTROL
  const SESSION_QUESTIONS = 9; // 8-12 recommended for ~30-40 minutes
  let questionsAsked = 0;

  // ------------------------------
  // Embedded quiz JSON (from your quiz.json)
window.__EMBEDDED_JSON__ = {
  "meta": {
    "title": "Sets & Probability ‚Äî Full Practice Bank (embedded)",
    "version": "1.0",
    "created": "2025-11-09T16:12:00Z",
    "notes": "40-item bank: 2-set Venns, set ops, counting, basic probability. Text answers matched by case-insensitive contains. Numeric tolerance 0.005."
  },
  "questions": [
    {"id":"Q1","topic":"set-operations","level":"beginner","type":"short","prompt":"In words, describe A ‚à™ B.","answer":"elements that are in A or in B or in both","hints":["'Or' includes either set or both.","Start: 'Elements that are in...'."],"solution":"A ‚à™ B = elements in A or in B (including both)."},
    {"id":"Q2","topic":"set-operations","level":"beginner","type":"short","prompt":"In words, describe A ‚à© B.","answer":"elements that are in both A and B","hints":["Intersection means 'both'.","Start: 'Elements that are in both...'."],"solution":"A ‚à© B = elements that are in both A and B."},
    {"id":"Q3","topic":"set-symbols","level":"beginner","type":"mcq","prompt":"Which symbol denotes 'element of' (is an element of)?","choices":["‚äÇ","‚àà","‚à©"],"answer_index":1,"hints":["It's used like: x ‚àà A.","The symbol looks like a stylized epsilon."],"solution":"The symbol ‚àà denotes 'element of'."},
    {"id":"Q4","topic":"set-count","level":"beginner","type":"short","prompt":"If A = {1,2,3,4}, what is |A|?","answer":4,"tolerance":0.005,"hints":["Count the elements.","There are four numbers listed."],"solution":"|A| is the number of elements: 4."},
    {"id":"Q5","topic":"venn-basic","level":"beginner","type":"short","prompt":"In the Venn diagram, what is |A ‚à™ B|?","image":"data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' width='300' height='140' viewBox='0 0 300 140'><circle cx='100' cy='70' r='50' fill='%2300a2b8' fill-opacity='0.18'/><circle cx='180' cy='70' r='50' fill='%23ff6b8a' fill-opacity='0.16'/><text x='65' y='76' font-size='14' fill='%2300222a'>6</text><text x='132' y='76' font-size='14' fill='%2300222a'>2</text><text x='200' y='76' font-size='14' fill='%2300222a'>5</text></svg>","image_alt":"Venn: A only 6, overlap 2, B only 5","answer":"13","hints":["Add A-only + overlap + B-only.","6 + 2 + 5 = 13."],"solution":"Union = 6 + 2 + 5 = 13."},
    {"id":"Q6","topic":"venn-basic","level":"beginner","type":"short","prompt":"In the Venn diagram, how many are only in A?","image":"data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' width='300' height='140' viewBox='0 0 300 140'><circle cx='100' cy='70' r='50' fill='%2300a2b8' fill-opacity='0.18'/><circle cx='180' cy='70' r='50' fill='%23ff6b8a' fill-opacity='0.16'/><text x='70' y='76' font-size='14' fill='%2300222a'>7</text><text x='132' y='76' font-size='14' fill='%2300222a'>3</text><text x='200' y='76' font-size='14' fill='%2300222a'>4</text></svg>","image_alt":"Venn: A only 7, overlap 3, B only 4","answer":"7","hints":["Look at the left-only region.","That region shows 7."],"solution":"Only-in-A region contains 7 elements."},
    {"id":"Q7","topic":"set-formula","level":"intermediate","type":"mcq","prompt":"Which formula gives |A ‚à™ B|?","choices":["|A| + |B|","|A| + |B| ‚àí |A ‚à© B|","|A| ‚àí |B|"],"answer_index":1,"hints":["Adding |A| and |B| double-counts overlap.","Subtract the overlap once."],"solution":"|A ‚à™ B| = |A| + |B| ‚àí |A ‚à© B|."},
    {"id":"Q8","topic":"venn-overlap","level":"intermediate","type":"short","prompt":"If |A|=12, |B|=9 and |A ‚à© B|=3, what is |A ‚à™ B|?","answer":18,"tolerance":0.005,"hints":["Use the union formula.","12 + 9 ‚àí 3 = 18."],"solution":"|A ‚à™ B| = 12 + 9 ‚àí 3 = 18."},
    {"id":"Q9","topic":"probability","level":"beginner","type":"numeric","prompt":"A bag has 2 red and 3 blue counters. Probability of drawing red?","answer":0.4,"tolerance":0.005,"hints":["Probability = favourable / total.","2 red out of 5 total ‚Üí 2/5 = 0.4."],"solution":"P(red) = 2/5 = 0.4."},
    {"id":"Q10","topic":"probability","level":"beginner","type":"mcq","prompt":"Which is a valid probability?","choices":["‚àí0.2","0.5","1.2"],"answer_index":1,"hints":["Probabilities are between 0 and 1 inclusive.","Choose the option between 0 and 1."],"solution":"Valid probabilities lie in [0,1]; 0.5 is valid."},
    {"id":"Q11","topic":"venn-diagram","level":"beginner","type":"short","prompt":"In the Venn diagram, what is the overlap size?","image":"data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' width='300' height='140' viewBox='0 0 300 140'><circle cx='100' cy='70' r='50' fill='%2300a2b8' fill-opacity='0.18'/><circle cx='180' cy='70' r='50' fill='%23ff6b8a' fill-opacity='0.16'/><text x='95' y='76' font-size='14' fill='%2300222a'>4</text><text x='136' y='76' font-size='14' fill='%2300222a'>6</text><text x='198' y='76' font-size='14' fill='%2300222a'>5</text></svg>","image_alt":"Venn: A only 4, overlap 6, B only 5","answer":"6","hints":["Overlap is the middle number.","It shows 6."],"solution":"The intersection region shows 6 elements."},
    {"id":"Q12","topic":"set-membership","level":"beginner","type":"short","prompt":"Is 3 ‚àà {1,2,3}? Answer 'yes' or 'no'.","answer":"yes","hints":["Check if 3 is listed.","3 appears in the set."],"solution":"3 is in the set, so yes."},
    {"id":"Q13","topic":"set-difference","level":"intermediate","type":"short","prompt":"Describe A \\ B in words.","answer":"elements in A but not in B","hints":["Think 'remove anything also in B' from A.","Start: 'Elements in A but not...'."],"solution":"A \\ B = elements that are in A but not in B."},
    {"id":"Q14","topic":"venn-basic","level":"beginner","type":"mcq","prompt":"If the Venn shows A-only 3, overlap 2, B-only 5, which is |A|?","choices":["3","5","5 (3+2)"],"answer_index":2,"hints":["|A| = A-only + overlap.","Compute 3 + 2."],"solution":"|A| = 3 + 2 = 5."},
    {"id":"Q15","topic":"probability","level":"beginner","type":"mcq","prompt":"Which event is complementary to 'draw a red'?","choices":["draw a red","draw not red","draw a blue"],"answer_index":1,"hints":["Complement means 'not that event'.","Pick the option that says not red."],"solution":"The complement of 'draw red' is 'draw not red'."},
    {"id":"Q16","topic":"venn-word","level":"intermediate","type":"short","prompt":"If A ‚äÇ B, what can you say about A ‚à© B?","answer":"A ‚à© B = A","hints":["If A is a subset of B everything in A is also in B.","Intersection will be A itself."],"solution":"If A ‚äÇ B then A ‚à© B = A."},
    {"id":"Q17","topic":"sets-count","level":"intermediate","type":"short","prompt":"If universal set U has 20 elements and |A|=8, |B|=7, |A‚à©B|=3, how many are in neither A nor B?","answer":8,"tolerance":0.005,"hints":["Compute |A ‚à™ B| first.","Then subtract from 20."],"solution":"|A ‚à™ B| = 8+7‚àí3 =12, neither = 20‚àí12 = 8."},
    {"id":"Q18","topic":"probability","level":"intermediate","type":"numeric","prompt":"A fair coin flip: probability of tails?","answer":0.5,"tolerance":0.005,"hints":["Two equally likely outcomes.","Tails is one of two."],"solution":"P(tails) = 1/2 = 0.5."},
    {"id":"Q19","topic":"venn-diagram","level":"intermediate","type":"short","prompt":"In the Venn diagram, what is |A ‚à© B|?","image":"data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' width='320' height='160' viewBox='0 0 320 160'><circle cx='110' cy='80' r='50' fill='%2300a2b8' fill-opacity='0.18'/><circle cx='190' cy='80' r='50' fill='%23ff6b8a' fill-opacity='0.16'/><text x='78' y='86' font-size='14' fill='%2300222a'>10</text><text x='138' y='86' font-size='14' fill='%2300222a'>4</text><text x='206' y='86' font-size='14' fill='%2300222a'>6</text></svg>","image_alt":"Venn: A only 10, overlap 4, B only 6","answer":"4","hints":["Middle number is the overlap.","It shows 4."],"solution":"The overlap region contains 4."},
    {"id":"Q20","topic":"set-formula","level":"intermediate","type":"short","prompt":"Solve for |A ‚à© B| given |A|=18, |B|=12, |A ‚à™ B|=22.","answer":"8","hints":["Use |A ‚à™ B| = |A| + |B| ‚àí |A ‚à© B|.","Rearrange and solve for intersection."],"solution":"|A ‚à© B| = 18 + 12 ‚àí 22 = 8."},
    {"id":"Q21","topic":"probability","level":"intermediate","type":"numeric","prompt":"A bag has 3 white, 2 black, 5 red. Probability of drawing red?","answer":0.5,"tolerance":0.005,"hints":["Total = 3+2+5.","Favourable = red count."],"solution":"P(red)=5/10 = 0.5."},
    {"id":"Q22","topic":"venn-basic","level":"beginner","type":"short","prompt":"In the Venn diagram, what is |B|?","image":"data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' width='320' height='160' viewBox='0 0 320 160'><circle cx='110' cy='80' r='50' fill='%2300a2b8' fill-opacity='0.18'/><circle cx='190' cy='80' r='50' fill='%23ff6b8a' fill-opacity='0.16'/><text x='78' y='86' font-size='14' fill='%2300222a'>4</text><text x='138' y='86' font-size='14' fill='%2300222a'>3</text><text x='206' y='86' font-size='14' fill='%2300222a'>7</text></svg>","image_alt":"Venn: A only 4, overlap 3, B only 7","answer":"10","hints":["|B| = B-only + overlap.","3 + 7 = 10."],"solution":"|B| = 7 + 3 = 10."},
    {"id":"Q23","topic":"set-ops","level":"intermediate","type":"mcq","prompt":"Which expression counts elements only in A (not B)?","choices":["A ‚à© B","A \\ B","A ‚à™ B"],"answer_index":1,"hints":["You want A excluding B.","This is set difference."],"solution":"A \\ B denotes elements in A but not in B."},
    {"id":"Q24","topic":"probability","level":"intermediate","type":"numeric","prompt":"Two dice rolled: probability both show 6?","answer":0.027777777777777776,"tolerance":0.005,"hints":["Each die has 1/6 chance for 6.","Multiply probabilities for independent events."],"solution":"P = (1/6)*(1/6) = 1/36 ‚âà 0.0278."},
    {"id":"Q25","topic":"venn-diagram","level":"intermediate","type":"short","prompt":"If A-only 9, overlap 4, B-only 5, what is total universal?","answer":"18","hints":["Add the three regions.","9 + 4 + 5 = 18."],"solution":"Total = 9 + 4 + 5 = 18."},
    {"id":"Q26","topic":"sets","level":"beginner","type":"short","prompt":"Is the empty set subset of every set? Answer 'yes' or 'no'.","answer":"yes","hints":["Empty set has no elements to contradict subset property.","Definition: ‚àÖ ‚äÇ A is true for all A."],"solution":"Yes ‚Äî ‚àÖ is subset of every set."},
    {"id":"Q27","topic":"venn-overlap","level":"intermediate","type":"short","prompt":"Given |A ‚à™ B| = 15, |A|=9, |B|=8, find |A ‚à© B|.","answer":"2","hints":["Use union formula.","9 + 8 ‚àí x = 15 ‚Üí x = 2."],"solution":"Intersection = 9 + 8 ‚àí 15 = 2."},
    {"id":"Q28","topic":"probability","level":"intermediate","type":"mcq","prompt":"Which is largest: probability of an impossible event, fair coin heads, certain event?","choices":["0","0.5","1"],"answer_index":2,"hints":["Impossible = 0, certain = 1.","Pick the largest value."],"solution":"Certain event has probability 1, which is largest."},
    {"id":"Q29","topic":"venn-diagram","level":"intermediate","type":"short","prompt":"In Venn: A only 2, overlap 1, B only 2. What fraction of universal are in A?","answer":"3/5","hints":["|A| = A-only + overlap = 2 + 1.","Total = 2+1+2 = 5."],"solution":"|A|=3 and total 5 so fraction = 3/5."},
    {"id":"Q30","topic":"set-ops","level":"intermediate","type":"short","prompt":"If A ‚à© B = ‚àÖ, what is |A ‚à™ B|?","hints":["No overlap means union = sum of sizes.","Add |A| and |B|."],"answer":"|A| + |B|","solution":"When intersection empty, |A ‚à™ B| = |A| + |B|."},
    {"id":"Q31","topic":"probability","level":"intermediate","type":"numeric","prompt":"A spinner with 8 equal sectors: probability of landing on a given sector?","answer":0.125,"tolerance":0.005,"hints":["Each sector equally likely.","Probability = 1 divided by 8."],"solution":"P = 1/8 = 0.125."},
    {"id":"Q32","topic":"venn-challenge","level":"challenge","type":"short","prompt":"If |A|=20, |B|=15 and |A ‚à© B|=6, what fraction of elements are in exactly one of A or B?","hints":["Exactly one = |A only| + |B only| = |A|+|B|‚àí2|A‚à©B|.","Compute and divide by total if total known; assume universal = A‚à™B."],"answer":"(20-6)+(15-6)","solution":"Exactly one = (20‚àí6)+(15‚àí6) = 23; if universal = A‚à™B = 29 then fraction = 23/29."},
    {"id":"Q33","topic":"sets","level":"challenge","type":"short","prompt":"Write in words: x ‚àâ A.","answer":"x is not an element of A","hints":["Negation of ‚àà.","Read 'not an element of'."],"solution":"x ‚àâ A means x is not in the set A."},
    {"id":"Q34","topic":"venn-diagram","level":"intermediate","type":"mcq","prompt":"If Venn shows A-only 8, overlap 3, B-only 5, which is |A ‚à™ B|?","choices":["16","13","11"],"answer_index":0,"hints":["Union = sum of the three regions.","8+3+5 = 16."],"solution":"Union = 8 + 3 + 5 = 16."},
    {"id":"Q35","topic":"probability","level":"challenge","type":"numeric","prompt":"If probability of event A is 0.3 and event B is 0.4 and they are disjoint, what is P(A ‚à™ B)?","answer":0.7,"tolerance":0.005,"hints":["Disjoint means P(A‚à©B)=0.","Add the probabilities."],"solution":"P(A ‚à™ B) = 0.3 + 0.4 = 0.7."},
    {"id":"Q36","topic":"venn-basic","level":"beginner","type":"short","prompt":"In the Venn diagram, what number is in the overlap?","image":"data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' width='320' height='160' viewBox='0 0 320 160'><circle cx='110' cy='80' r='50' fill='%2300a2b8' fill-opacity='0.18'/><circle cx='190' cy='80' r='50' fill='%23ff6b8a' fill-opacity='0.16'/><text x='82' y='86' font-size='14' fill='%2300222a'>5</text><text x='138' y='86' font-size='14' fill='%2300222a'>2</text><text x='206' y='86' font-size='14' fill='%2300222a'>4</text></svg>","image_alt":"Venn: A only 5, overlap 2, B only 4","answer":"2","hints":["Middle number is overlap.","It shows 2."],"solution":"Overlap region = 2."},
    {"id":"Q37","topic":"sets","level":"intermediate","type":"short","prompt":"True or False: If A ‚äÇ B then |A| < |B|. Answer 'true' or 'false'.","answer":"false","hints":["Subset can be proper or equal.","If A = B then sizes equal."],"solution":"False ‚Äî A ‚äÇ B can be proper subset or equal depending on notation; size might be equal if same set."},
    {"id":"Q38","topic":"probability","level":"intermediate","type":"mcq","prompt":"Which statement is true for independent events A and B?","choices":["P(A‚à©B)=P(A)P(B)","P(A‚à©B)=P(A)+P(B)","P(A‚à™B)=P(A)P(B)"],"answer_index":0,"hints":["Use independence definition.","Multiply probabilities for intersection."],"solution":"For independent A and B: P(A‚à©B) = P(A)P(B)."},
    {"id":"Q39","topic":"venn-challenge","level":"challenge","type":"short","prompt":"Given universal set size 50, |A|=30, |B|=25, and |A ‚à© B|=10, how many are in neither set?","answer":5,"tolerance":0.005,"hints":["Compute union = 30+25‚àí10.","Neither = 50 ‚àí union."],"solution":"Union = 45, so neither = 50 ‚àí 45 = 5."},
    {"id":"Q40","topic":"review","level":"challenge","type":"short","prompt":"Write a short explanation of why we subtract the intersection when computing |A ‚à™ B|.","answer":"to avoid double-counting elements in the overlap","hints":["When adding |A| and |B|, overlap counted twice.","We subtract overlap once to correct double count."],"solution":"We subtract |A‚à©B| because elements in the intersection are included in both |A| and |B| and would be counted twice, so subtracting removes the duplicate count."}
  ]
};
  // ------------------------------
  // State & small bank adapter
  const $ = (sel)=>document.querySelector(sel);
  const rand = (a,b)=> Math.floor(Math.random()*(b-a+1))+a;

  const state = {
    useBank: true,
    bank: [],
    i:0,
    progressInRow:0,
    typeRepLeft:3,
    attemptsLeft:3,
    current:{},
    minutesEarned: 0,
    streak: 0,
    dailyCap: 20,
  };

  const LS_KEY = "mlm_progress_v1";
  function save(){ localStorage.setItem(LS_KEY, JSON.stringify({minutesEarned:state.minutesEarned, streak:state.streak})); }
  function load(){ try{ const d=JSON.parse(localStorage.getItem(LS_KEY)||"{}"); state.minutesEarned=d.minutesEarned||0; state.streak=d.streak||0;}catch(e){} }

  function buildBankFromEmbedded(embed){
    if(!embed || !Array.isArray(embed.questions)) return [];
    return embed.questions.map(q=>({
      id: q.id || ('q_'+Math.random().toString(36).slice(2)),
      prompt: q.prompt,
      type: q.type || 'short',
      answer: (q.type==='numeric' ? Number(q.answer) : q.answer),
      choices: q.choices || null,
      answer_index: q.answer_index ?? null,
      clue: (q.hints && q.hints[0]) || (q.clue || ''),
      hints: q.hints || [],
      explain: q.solution || q.explain || '',
      topic: q.topic || '',
      level: q.level || ''
    }));
  }

  function round2(x){ return Math.round(x*100)/100; }

  function renderBankQuestion(){
    const box = document.getElementById('questionText');
    if(!state.bank.length){ box.textContent = 'No questions in the bank.'; return; }
    const q = state.bank[state.i];
    state.current = q;
    state.attemptsLeft = 3;
    document.getElementById('questionText').textContent = q.prompt;
    const work = document.getElementById('workArea'); work.innerHTML = '';
    const fb = document.getElementById('feedback'); fb.style.display='none';

    if(q.type === 'mcq' && Array.isArray(q.choices)){
      work.innerHTML = q.choices.map((c,idx)=>`<label style="display:block;margin:6px 0;"><input name="opt" type="radio" value="${idx}"> ${c}</label>`).join('');
    } else {
      const input = document.createElement('input');
      input.id = 'answerInput';
      input.type = (typeof q.answer === 'number') ? 'number' : 'text';
      input.placeholder = (input.type==='number') ? 'enter a number (2dp ok)' : 'your answer';
      work.appendChild(input);
      setTimeout(()=>input.focus(),50);
    }
    $('#feedback').style.display='none';
    $('#inlineReflectRow').style.display='none';
    $('#submitBtn').style.display='none';
    $('#quickNextBtn').style.display='none';
    updateHUD();
  }

  function compareAnswers(user, truth){
    if(typeof truth === 'string') return String(user||'').trim().toLowerCase() === String(truth).trim().toLowerCase();
    if(typeof truth === 'number') {
      const u = Number(user);
      if(Number.isNaN(u)) return false;
      return Math.abs(u - truth) < 0.005;
    }
    return false;
  }

  function checkBankAnswer(){
    const fb = document.getElementById('feedback');
    const q = state.current;
    let ok=false;
    if(q.type==='mcq' && q.choices){
      const sel = document.querySelector('input[name=opt]:checked');
      if(!sel){ alert('Pick an option.'); return; }
      ok = Number(sel.value) === q.answer_index;
    } else {
      const v = document.getElementById('answerInput').value;
      ok = compareAnswers(v, q.answer);
    }

    if(!q.attempts) q.attempts = 0;
    q.attempts++;
    if(ok){
      fb.style.display='block'; fb.style.borderLeftColor='var(--good)';
      fb.innerHTML = `‚úÖ Correct. ${q.explain ? (' ‚Äî '+q.explain) : ''}`;
      confettiBurst();
      state.streak++; save();
      setTimeout(nextBankQuestion, 700);
    } else {
      fb.style.display='block'; fb.style.borderLeftColor='var(--bad)';
      const h = (q.hints && q.hints[q.attempts-1]) || q.clue || "Try a small step.";
      fb.innerHTML = `‚ùå Not yet. Hint: ${h}`;
      state.streak = 0; save();
      if(q.attempts >= (q.hints? q.hints.length+1 : 2)){ 
        setTimeout(()=>{ fb.innerHTML += `<div style=\"margin-top:8px;color:var(--muted)\">Solution: ${q.explain || q.answer}</div>`; }, 300);
      }
    }
    updateHUD();
  }

  function nextBankQuestion(){
    questionsAsked++;
    if(questionsAsked >= SESSION_QUESTIONS){
      document.getElementById('questionText').textContent = `Session complete! You completed ${questionsAsked} questions. üéâ`;
      document.getElementById('workArea').innerHTML = '<div class="msg">Take a short break and celebrate the wins. Review hints if needed.</div>';
      updateHUD();
      openWheel();
      return;
    }
    if(state.i < state.bank.length - 1){ state.i++; renderBankQuestion(); } else { finishSession(); }
  }

  function finishSession(){
    document.getElementById('questionText').textContent = 'End of bank.';
    document.getElementById('workArea').innerHTML = '<div class="msg">Well done ‚Äî review or try another level.</div>';
    openWheel();
  }

  const wedgeMinutes = [0,1,2,3,4,5,2,3];
  function drawWheel(){ const wheel = $('#wheel'); wheel.innerHTML=''; const colors = ['#14b8a6','#22d3ee','#34d399','#fbbf24','#60a5fa','#c084fc','#fb7185','#38bdf8']; const N = wedgeMinutes.length; for(let i=0;i<N;i++){ const slice = document.createElement('div'); slice.className='slice'; const deg = 360/N; const a = i*deg; slice.style.transform = `rotate(${a}deg) skewY(${90-deg}deg)`; slice.style.background = colors[i%colors.length]; slice.style.opacity = .9; const lab = document.createElement('div'); lab.style.position='absolute'; lab.style.top='50%'; lab.style.left='50%'; lab.style.transform = `rotate(${deg/2}deg) translate(10px,-50%) skewY(-${90-deg}deg)`; lab.style.transformOrigin='0 0'; lab.style.color='#001018'; lab.style.fontWeight='700'; lab.textContent = `${wedgeMinutes[i]} min`; slice.appendChild(lab); wheel.appendChild(slice); } }
  function openWheel(){ $('#wheelModal').style.display='block'; }
  function closeWheel(){ $('#wheelModal').style.display='none'; }
  function spin(){ const wheel = $('#wheel'); const N = wedgeMinutes.length; const deg = 360/N; const targetIdx = rand(0, N-1); const spins = 6*360; const stopAt = spins + (targetIdx*deg) + deg/2 + rand(-5,5); wheel.style.transition = 'transform 3.2s cubic-bezier(.22,.8,.24,1)'; wheel.style.transform = `rotate(${stopAt}deg)`; setTimeout(()=>{ const prize = wedgeMinutes[targetIdx]; const remainingCap = Math.max(0, state.dailyCap - state.minutesEarned); const awarded = Math.min(prize, remainingCap); state.minutesEarned += awarded; save(); $('#minutesEarned').textContent = state.minutesEarned; $('#wheelMsg').textContent = awarded>0 ? `üéâ You earned ${awarded} minute(s)!` : `‚ú® Cap reached today.`; }, 3300); }

  function updateHUD(){
    $('#attemptsLeft').textContent = state.attemptsLeft;
    $('#repLeft').textContent = state.typeRepLeft;
    $('#levelMastery').textContent = `${state.progressInRow}/5`;
    $('#minutesEarned').textContent = state.minutesEarned;
    $('#streak').textContent = state.streak;
    $('#progressBar').style.width = `${(state.progressInRow/5)*100}%`;
  }

  $('#checkBtn').addEventListener('click', ()=>{ if(state.useBank && state.bank.length) checkBankAnswer(); });
  $('#submitBtn').addEventListener('click', nextBankQuestion);
  $('#quickNextBtn').addEventListener('click', nextBankQuestion);
  $('#skipBtn').addEventListener('click', ()=>{ state.streak=0; save(); if(state.useBank) nextBankQuestion(); });
  $('#hintBtn').addEventListener('click', ()=>{ const q = state.current; if(q && q.hints && q.hints[0]) { document.getElementById('feedback').innerHTML = 'üí° '+q.hints[0]; document.getElementById('feedback').style.display='block'; }});
  $('#spinBtn').addEventListener('click', spin);
  $('#closeWheelBtn').addEventListener('click', closeWheel);
  $('#previewModeBtn').addEventListener('click', ()=>{ questionsAsked=0; state.i=0; renderBankQuestion(); });

  document.addEventListener('keydown', (e)=>{ if(e.key==='Enter'){ const submitShown = ($('#submitBtn') && $('#submitBtn').style.display !== 'none') || ($('#quickNextBtn') && $('#quickNextBtn').style.display !== 'none'); submitShown ? nextBankQuestion() : (state.useBank? checkBankAnswer() : null); } });

  load(); drawWheel(); updateHUD();
  (function initBank(){ const embed = window.__EMBEDDED_JSON__ || null; state.bank = buildBankFromEmbedded(embed); if(state.bank.length) state.useBank = true; else state.useBank = false; // set UI count
    const el = document.getElementById('loadedCount'); if(el) el.textContent = `Questions: ${state.bank.length} (embedded)`; })();

  function confettiBurst(){ const fx = document.querySelector('#fx'); const colors = ['#14b8a6','#22d3ee','#34d399','#fbbf24','#60a5fa']; for(let i=0;i<18;i++){ const d = document.createElement('div'); d.className='confetti'; d.style.left = Math.random()*100 + 'vw'; d.style.top = '-10vh'; d.style.background = colors[i%colors.length]; d.style.transform = `translateY(-20px) rotate(${Math.random()*360}deg)`; d.style.animation = `fall ${1.2 + Math.random()*0.9}s linear forwards`; fx.appendChild(d); setTimeout(()=> d.remove(), 2200); } }
</script>
</body>
</html>
